<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CastPets - –¢–æ—Ä–≥–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞ –ø–µ—Ç–æ–≤</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; width: 100%; overflow: auto; }
        body { 
            background: #000 url('https://among.chat/images/bg.png') center/cover fixed; 
            color: #fff; 
            font-family: '07YasasahisaAntique', sans-serif; 
            padding: 10px;
        }
        .container {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 0 30px rgba(106, 64, 191, 0.6);
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            min-height: 90vh;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #6a40bf;
        }
        h1 {
            font-size: 2.5rem;
            color: #4ecdc4;
            margin-bottom: 10px;
            text-shadow: 0 0 15px rgba(78, 205, 196, 0.7);
        }
        .user-info {
            background: linear-gradient(45deg, rgba(106, 64, 191, 0.3), rgba(78, 205, 196, 0.2));
            padding: 12px;
            border-radius: 10px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        .balance {
            font-size: 1.2rem;
            color: #ff6b6b;
            font-weight: bold;
        }
        .pets-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 20px; 
            margin: 20px 0;
        }
        .pet-card { 
            background: linear-gradient(145deg, rgba(106, 64, 191, 0.4), rgba(78, 205, 196, 0.3)); 
            border-radius: 15px; 
            padding: 15px; 
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .pet-card:hover { 
            transform: translateY(-5px) scale(1.02); 
            box-shadow: 0 10px 25px rgba(106, 64, 191, 0.6);
        }
        .pet-icon { 
            font-size: 40px; 
            margin-bottom: 10px; 
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
        }
        .pet-name {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: #4ecdc4;
            font-weight: bold;
        }
        .pet-price {
            color: #ff6b6b;
            font-weight: bold;
            margin: 10px 0;
            font-size: 1.1rem;
        }
        .btn { 
            color: white; 
            border: none; 
            padding: 10px 15px; 
            border-radius: 25px; 
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }
        .btn:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.4), transparent);
            transform: rotate(45deg);
            animation: shine 2s infinite;
        }
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }
        .btn-buy {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }
        .btn-sell {
            background: linear-gradient(45deg, #6a40bf, #4a2a9e);
            box-shadow: 0 0 15px rgba(106, 64, 191, 0.6);
        }
        .btn-withdraw {
            background: linear-gradient(45deg, #ff6b6b, #ff0000);
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.6);
        }
        .btn-delete {
            background: linear-gradient(45deg, #ff4757, #ff0000);
            box-shadow: 0 0 15px rgba(255, 71, 87, 0.6);
        }
        .market-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #6a40bf;
            gap: 5px;
        }
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background: rgba(106, 64, 191, 0.3);
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
        }
        .tab.active {
            background: #6a40bf;
            box-shadow: 0 0 15px rgba(106, 64, 191, 0.6);
        }
        .tab-content {
            display: none;
            flex: 1;
        }
        .tab-content.active {
            display: block;
        }
        .admin-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 20px;
            border-radius: 20px;
            border: 3px solid #6a40bf;
            box-shadow: 0 0 50px rgba(106, 64, 191, 0.8);
            z-index: 10000;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }
        .admin-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 2px solid #6a40bf;
            gap: 5px;
        }
        .admin-tab {
            padding: 10px 15px;
            cursor: pointer;
            background: rgba(106, 64, 191, 0.3);
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        .admin-tab.active {
            background: #6a40bf;
            box-shadow: 0 0 10px rgba(106, 64, 191, 0.6);
        }
        .admin-tab-content {
            display: none;
        }
        .admin-tab-content.active {
            display: block;
        }
        .admin-input {
            padding: 12px;
            border-radius: 10px;
            border: 2px solid #6a40bf;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            margin: 8px 0;
            width: 100%;
        }
        .admin-btn {
            background: linear-gradient(45deg, #6a40bf, #ff6b6b);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            margin: 8px 0;
            width: 100%;
            font-weight: bold;
        }
        .withdrawal-item {
            background: rgba(106, 64, 191, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border: 1px solid #6a40bf;
        }
        .check-btn {
            background: linear-gradient(45deg, #4ecdc4, #2a9d8f);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6a40bf;
            font-size: 1.2rem;
        }
        .status-message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: center;
        }
        .success {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }
        .error {
            background: rgba(255, 0, 0, 0.2);
            color: #ff6b6b;
        }
    </style>
    <link href="https://fonts.cdnfonts.com/css/07yasasahisa-antique" rel="stylesheet">
</head>
<body oncontextmenu="return false;">
    <div class="container">
        <header>
            <h1>CastPets</h1>
            <p>–¢–æ—Ä–≥–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö –ø–µ—Ç–æ–≤</p>
            <div class="user-info">
                <div class="user-id">ID: <span id="user-id">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
                <div class="balance">–ë–∞–ª–∞–Ω—Å: <span id="user-balance">100</span> –º–æ–Ω–µ—Ç</div>
            </div>
        </header>

        <div class="market-tabs">
            <div class="tab active" id="market-tab-btn" onclick="switchTab('market')">–†—ã–Ω–æ–∫</div>
            <div class="tab" onclick="switchTab('my-pets')">–ú–æ–∏ –ø–µ—Ç—ã</div>
            <div class="tab" onclick="switchTab('codes')">–ö–æ–¥—ã</div>
        </div>

        <div id="market-tab" class="tab-content active">
            <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ç—ã</h2>
            <div class="pets-grid" id="market-pets">
                <div class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ç–æ–≤...</div>
            </div>
        </div>

        <div id="my-pets" class="tab-content">
            <h2>–ú–æ–∏ –ø–µ—Ç—ã</h2>
            <div class="pets-grid" id="user-pets">
                <div class="empty-state">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–µ—Ç–æ–≤</div>
            </div>
        </div>

        <div id="codes-tab" class="tab-content">
            <h2>–ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ–¥–æ–≤</h2>
            <input type="text" id="user-activate-code" class="admin-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥">
            <button class="btn btn-buy" onclick="activateUserCode()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
            <div id="code-activation-status" class="status-message"></div>
        </div>
    </div>

    <div class="admin-panel" id="admin-panel">
        <h2>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
        
        <div class="admin-tabs">
            <div class="admin-tab active" onclick="switchAdminTab('main')">–û—Å–Ω–æ–≤–Ω–æ–µ</div>
            <div class="admin-tab" onclick="switchAdminTab('create-pet')">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ç–∞</div>
            <div class="admin-tab" onclick="switchAdminTab('withdrawals')">–í—ã–≤–æ–¥—ã</div>
            <div class="admin-tab" onclick="switchAdminTab('manage-pets')">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
        </div>

        <div id="admin-main" class="admin-tab-content active">
            <input type="password" id="admin-password" class="admin-input" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="admin-btn" onclick="checkAdminPassword()">–í–æ–π—Ç–∏</button>
        </div>

        <div id="admin-create-pet" class="admin-tab-content">
            <input type="text" id="pet-name" class="admin-input" placeholder="–ò–º—è –ø–µ—Ç–∞">
            <input type="number" id="pet-price" class="admin-input" placeholder="–¶–µ–Ω–∞">
            <input type="text" id="pet-icon" class="admin-input" placeholder="–≠–º–æ–¥–∑–∏ (üê±)">
            <button class="admin-btn" onclick="createPet()">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ç–∞</button>
            <div id="pet-creation-status" class="status-message"></div>
        </div>

        <div id="admin-withdrawals" class="admin-tab-content">
            <h3>–ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –≤—ã–≤–æ–¥</h3>
            <div id="withdrawals-list">
                <div class="empty-state">–ù–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤</div>
            </div>
        </div>

        <div id="admin-manage-pets" class="admin-tab-content">
            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ç–∞–º</h3>
            <div id="all-pets-list">
                <div class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ç–æ–≤...</div>
            </div>
        </div>

        <div id="admin-content" style="display:none">
            <h3>–°–æ–∑–¥–∞—Ç—å –∫–æ–¥</h3>
            <input type="number" id="coins-amount" class="admin-input" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç">
            <button class="admin-btn" onclick="generateCode()">–°–æ–∑–¥–∞—Ç—å –∫–æ–¥</button>
            <div id="generated-code" class="status-message"></div>
            <div id="code-generation-status" class="status-message"></div>
        </div>
    </div>

    <script>
        const JSONBIN_API_KEY = '$2a$10$7SFvJJcyxHLcjDA7bXPc/uEBf2P/uB7/tp2WZiyjDwpFtIuCmviHS';
        const JSONBIN_BIN_ID = '68b08a9aae596e708fda3c11';
        
        let cachedData = null;
        let adminClickCount = 0;
        let lastAdminClick = 0;

        function encryptPetName(name) {
            const symbols = ['@', '#', '$', '%', '&', '*', '!', '?'];
            let encrypted = '';
            
            for (let i = 0; i < name.length; i++) {
                if (i % 2 === 0 && i < 3) {
                    encrypted += Math.floor(Math.random() * 10);
                } else if (i % 3 === 0 && symbols.length > 0) {
                    encrypted += symbols[Math.floor(Math.random() * symbols.length)];
                } else {
                    encrypted += name[i];
                }
            }
            
            return encrypted.slice(0, 6);
        }

        async function initializeData() {
            try {
                const data = await getData();
                if (!data.codes) data.codes = {};
                if (!data.pets) data.pets = [];
                await saveData(data);
            } catch (error) {
                console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...');
            }
        }

        async function getData() {
            if (cachedData) return cachedData;
            
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
                    headers: { 
                        'X-Master-Key': JSONBIN_API_KEY,
                        'X-Bin-Meta': false
                    }
                });
                
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                
                const data = await response.json();
                cachedData = data || { codes: {}, pets: [] };
                return cachedData;
            } catch (error) {
                return { codes: {}, pets: [] };
            }
        }

        async function saveData(data) {
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify(data)
                });
                
                cachedData = data;
                return await response.json();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                throw error;
            }
        }

        function initUser() {
            let userId = localStorage.getItem('user_id') || Math.floor(1000 + Math.random() * 9000);
            let balance = localStorage.getItem('balance') || 100;
            
            localStorage.setItem('user_id', userId);
            localStorage.setItem('balance', balance);
            
            document.getElementById('user-id').textContent = userId;
            document.getElementById('user-balance').textContent = balance;
        }

        async function loadMarketPets() {
            try {
                const data = await getData();
                const container = document.getElementById('market-pets');
                const availablePets = data.pets.filter(pet => !pet.owner);
                
                container.innerHTML = availablePets.length ? '' : '<div class="empty-state">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–µ—Ç–æ–≤</div>';
                
                availablePets.forEach(pet => {
                    const card = document.createElement('div');
                    card.className = 'pet-card';
                    card.innerHTML = `
                        <div class="pet-icon">${pet.icon}</div>
                        <div class="pet-name">${pet.name}</div>
                        <div class="pet-price">${pet.price} –º–æ–Ω–µ—Ç</div>
                        <button class="btn btn-buy" onclick="buyPet('${pet.id}')">–ö—É–ø–∏—Ç—å</button>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                document.getElementById('market-pets').innerHTML = '<div class="empty-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        async function buyPet(petId) {
            try {
                const data = await getData();
                const pet = data.pets.find(p => p.id === petId);
                const balance = parseInt(localStorage.getItem('balance'));
                
                if (!pet) return alert('–ü–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                if (balance < pet.price) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
                
                pet.owner = localStorage.getItem('user_id');
                const newBalance = balance - pet.price;
                
                localStorage.setItem('balance', newBalance);
                document.getElementById('user-balance').textContent = newBalance;
                
                let userPets = JSON.parse(localStorage.getItem('user_pets') || '[]');
                userPets.push(petId);
                localStorage.setItem('user_pets', JSON.stringify(userPets));
                
                await saveData(data);
                loadMarketPets();
                loadUserPets();
                alert(`–í—ã –∫—É–ø–∏–ª–∏ ${pet.name}!`);
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ: ' + error.message);
            }
        }

        async function loadUserPets() {
            try {
                const data = await getData();
                const userPets = JSON.parse(localStorage.getItem('user_pets') || '[]');
                const container = document.getElementById('user-pets');
                
                const pets = data.pets.filter(pet => userPets.includes(pet.id));
                
                container.innerHTML = pets.length ? '' : '<div class="empty-state">–£ –≤–∞—Å –Ω–µ—Ç –ø–µ—Ç–æ–≤</div>';
                
                pets.forEach(pet => {
                    const card = document.createElement('div');
                    card.className = 'pet-card';
                    card.innerHTML = `
                        <div class="pet-icon">${pet.icon}</div>
                        <div class="pet-name">${pet.name}</div>
                        <div class="pet-price">–ö—É–ø–ª–µ–Ω –∑–∞: ${pet.price} –º–æ–Ω–µ—Ç</div>
                        <button class="btn btn-sell" onclick="sellPet('${pet.id}')">–ü—Ä–æ–¥–∞—Ç—å (${Math.floor(pet.price/2)} –º–æ–Ω–µ—Ç)</button>
                        <button class="btn btn-withdraw" onclick="withdrawPet('${pet.id}')">–í—ã–≤–µ—Å—Ç–∏</button>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                document.getElementById('user-pets').innerHTML = '<div class="empty-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        async function sellPet(petId) {
            if (!confirm('–ü—Ä–æ–¥–∞—Ç—å –∑–∞ –ø–æ–ª–æ–≤–∏–Ω—É —Å—Ç–æ–∏–º–æ—Å—Ç–∏?')) return;
            
            try {
                const data = await getData();
                const pet = data.pets.find(p => p.id === petId);
                const sellPrice = Math.floor(pet.price / 2);
                const balance = parseInt(localStorage.getItem('balance'));
                
                localStorage.setItem('balance', balance + sellPrice);
                document.getElementById('user-balance').textContent = balance + sellPrice;
                
                let userPets = JSON.parse(localStorage.getItem('user_pets') || '[]');
                userPets = userPets.filter(id => id !== petId);
                localStorage.setItem('user_pets', JSON.stringify(userPets));
                
                data.pets = data.pets.filter(p => p.id !== petId);
                await saveData(data);
                
                loadUserPets();
                loadMarketPets();
                alert(`–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${pet.name} –∑–∞ ${sellPrice} –º–æ–Ω–µ—Ç!`);
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ: ' + error.message);
            }
        }

        async function withdrawPet(petId) {
            try {
                const data = await getData();
                const pet = data.pets.find(p => p.id === petId);
                const userId = localStorage.getItem('user_id');
                const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
                
                const encryptedName = encryptPetName(pet.name);
                const withdrawalCode = `WD-${userId}-${encryptedName}`;
                
                withdrawals.push({
                    petId: petId,
                    userId: userId,
                    petName: pet.name,
                    encryptedName: encryptedName,
                    code: withdrawalCode,
                    status: 'pending',
                    date: new Date().toLocaleString()
                });
                
                localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
                
                let userPets = JSON.parse(localStorage.getItem('user_pets') || '[]');
                userPets = userPets.filter(id => id !== petId);
                localStorage.setItem('user_pets', JSON.stringify(userPets));
                
                alert(`–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ö–æ–¥: ${withdrawalCode}`);
                loadUserPets();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ: ' + error.message);
            }
        }

        async function activateUserCode() {
            const codeInput = document.getElementById('user-activate-code');
            const code = codeInput.value.trim();
            const statusElement = document.getElementById('code-activation-status');
            
            if (!code) {
                statusElement.textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥!';
                statusElement.className = 'status-message error';
                return;
            }
            
            try {
                const data = await getData();
                
                if (!data.codes[code]) {
                    statusElement.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!';
                    statusElement.className = 'status-message error';
                    return;
                }
                
                if (data.codes[code].used) {
                    statusElement.textContent = '–ö–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!';
                    statusElement.className = 'status-message error';
                    return;
                }
                
                data.codes[code].used = true;
                const coins = data.codes[code].coins;
                const balance = parseInt(localStorage.getItem('balance')) + coins;
                
                localStorage.setItem('balance', balance);
                document.getElementById('user-balance').textContent = balance;
                
                await saveData(data);
                
                statusElement.textContent = `–ü–æ–ª—É—á–µ–Ω–æ ${coins} –º–æ–Ω–µ—Ç!`;
                statusElement.className = 'status-message success';
                codeInput.value = '';
                
            } catch (error) {
                statusElement.textContent = '–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏!';
                statusElement.className = 'status-message error';
            }
        }

        function checkAdminPassword() {
            const password = document.getElementById('admin-password').value;
            if (password === '–í–ª–∞–¥27–°–µ–Ω—Ç—è–±—Ä—è') {
                document.getElementById('admin-content').style.display = 'block';
                loadWithdrawals();
                loadAllPets();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
            }
        }

        async function createPet() {
            const name = document.getElementById('pet-name').value.trim();
            const price = parseInt(document.getElementById('pet-price').value);
            const icon = document.getElementById('pet-icon').value.trim();
            const statusElement = document.getElementById('pet-creation-status');
            
            if (!name || isNaN(price) || price <= 0 || !icon) {
                statusElement.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!';
                statusElement.className = 'status-message error';
                return;
            }
            
            try {
                const data = await getData();
                const newPet = {
                    id: Date.now().toString(),
                    name: name,
                    price: price,
                    icon: icon,
                    owner: null,
                    createdAt: new Date().toISOString()
                };
                
                data.pets.push(newPet);
                await saveData(data);
                
                statusElement.textContent = '–ü–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!';
                statusElement.className = 'status-message success';
                
                document.getElementById('pet-name').value = '';
                document.getElementById('pet-price').value = '';
                document.getElementById('pet-icon').value = '';
                
                loadMarketPets();
                
            } catch (error) {
                statusElement.textContent = '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ç–∞!';
                statusElement.className = 'status-message error';
            }
        }

        async function generateCode() {
            const coins = parseInt(document.getElementById('coins-amount').value);
            const statusElement = document.getElementById('code-generation-status');
            const codeElement = document.getElementById('generated-code');
            
            if (isNaN(coins) || coins <= 0) {
                statusElement.textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç!';
                statusElement.className = 'status-message error';
                return;
            }
            
            try {
                const data = await getData();
                const code = 'CP-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                
                data.codes[code] = {
                    coins: coins,
                    used: false,
                    createdAt: new Date().toISOString()
                };
                
                await saveData(data);
                
                codeElement.textContent = `–°–æ–∑–¥–∞–Ω –∫–æ–¥: ${code}`;
                codeElement.className = 'status-message success';
                statusElement.textContent = `–ö–æ–¥ –Ω–∞ ${coins} –º–æ–Ω–µ—Ç —Å–æ–∑–¥–∞–Ω!`;
                statusElement.className = 'status-message success';
                
                document.getElementById('coins-amount').value = '';
                
            } catch (error) {
                statusElement.textContent = '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–¥–∞!';
                statusElement.className = 'status-message error';
            }
        }

        function loadWithdrawals() {
            const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
            const pending = withdrawals.filter(w => w.status === 'pending');
            const container = document.getElementById('withdrawals-list');
            
            container.innerHTML = pending.length ? '' : '<div class="empty-state">–ù–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤—ã–≤–æ–¥</div>';
            
            pending.forEach(withdrawal => {
                const item = document.createElement('div');
                item.className = 'withdrawal-item';
                item.innerHTML = `
                    <strong>${withdrawal.petName}</strong> (${withdrawal.encryptedName})<br>
                    ID: ${withdrawal.userId}<br>
                    –ö–æ–¥: ${withdrawal.code}<br>
                    –î–∞—Ç–∞: ${withdrawal.date}<br>
                    <button class="check-btn" onclick="approveWithdrawal('${withdrawal.petId}', '${withdrawal.userId}')">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–≤–æ–¥</button>
                `;
                container.appendChild(item);
            });
        }

        async function loadAllPets() {
            try {
                const data = await getData();
                const container = document.getElementById('all-pets-list');
                
                container.innerHTML = data.pets.length ? '' : '<div class="empty-state">–ù–µ—Ç –ø–µ—Ç–æ–≤</div>';
                
                data.pets.forEach(pet => {
                    const item = document.createElement('div');
                    item.className = 'withdrawal-item';
                    item.innerHTML = `
                        <strong>${pet.name}</strong> (${pet.icon})<br>
                        –¶–µ–Ω–∞: ${pet.price} –º–æ–Ω–µ—Ç<br>
                        –í–ª–∞–¥–µ–ª–µ—Ü: ${pet.owner || '–ù–µ—Ç'}<br>
                        <button class="check-btn" onclick="deletePet('${pet.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                    `;
                    container.appendChild(item);
                });
            } catch (error) {
                document.getElementById('all-pets-list').innerHTML = '<div class="empty-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        async function deletePet(petId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–µ—Ç–∞ –Ω–∞–≤—Å–µ–≥–¥–∞?')) return;
            
            try {
                const data = await getData();
                data.pets = data.pets.filter(p => p.id !== petId);
                await saveData(data);
                
                let userPets = JSON.parse(localStorage.getItem('user_pets') || '[]');
                userPets = userPets.filter(id => id !== petId);
                localStorage.setItem('user_pets', JSON.stringify(userPets));
                
                loadAllPets();
                loadMarketPets();
                alert('–ü–µ—Ç —É–¥–∞–ª–µ–Ω!');
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message);
            }
        }

        async function approveWithdrawal(petId, userId) {
            try {
                const data = await getData();
                data.pets = data.pets.filter(p => p.id !== petId);
                await saveData(data);
                
                let withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
                withdrawals = withdrawals.filter(w => w.petId !== petId);
                localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
                
                loadWithdrawals();
                alert('–í—ã–≤–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω! –ü–µ—Ç —É–¥–∞–ª–µ–Ω –∏–∑ —Å–∏—Å—Ç–µ–º—ã.');
                
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–≤–æ–¥–∞: ' + error.message);
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            const tabs = ['market', 'my-pets', 'codes'];
            const tabIndex = tabs.indexOf(tabName);
            
            if (tabIndex !== -1) {
                document.querySelectorAll('.tab')[tabIndex].classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');
            }
            
            if (tabName === 'market') loadMarketPets();
            if (tabName === 'my-pets') loadUserPets();
        }

        function switchAdminTab(tabName) {
            document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.admin-tab-content').forEach(content => content.classList.remove('active'));
            
            document.getElementById(`admin-${tabName}`).classList.add('active');
            document.querySelector(`.admin-tab:nth-child(${['main','create-pet','withdrawals','manage-pets'].indexOf(tabName)+1})`).classList.add('active');
            
            if (tabName === 'withdrawals') loadWithdrawals();
            if (tabName === 'manage-pets') loadAllPets();
        }

        function setupAdmin() {
            const marketTab = document.getElementById('market-tab-btn');
            marketTab.addEventListener('click', function() {
                const now = Date.now();
                if (now - lastAdminClick > 1000) {
                    adminClickCount = 0;
                }
                adminClickCount++;
                lastAdminClick = now;
                
                if (adminClickCount >= 5) {
                    document.getElementById('admin-panel').style.display = 'block';
                    adminClickCount = 0;
                }
            });
        }

        window.onload = async function() {
            await initializeData();
            initUser();
            loadMarketPets();
            loadUserPets();
            setupAdmin();
        };
    </script>
</body>
</html>
